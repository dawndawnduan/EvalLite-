<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>测试执行 - EvalLite</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/style.css">
</head>
<body class="min-h-screen">
    <!-- 导航栏将通过JS插入 -->

    <!-- Main Content -->
    <main class="page-container">
        <!-- Header -->
        <div class="mb-8">
            <h1 class="page-title">测试执行</h1>
            <p class="page-subtitle">配置并运行AI模型测试</p>
        </div>

        <!-- Test Configuration -->
        <div class="glass-effect rounded-2xl p-6 mb-6 shadow-lg">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">测试配置</h2>

            <!-- Task Mode Selection -->
            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">测试模式</label>
                <div class="flex gap-4">
                    <label class="flex items-center cursor-pointer">
                        <input type="radio" name="taskMode" value="single" checked class="mr-2">
                        <span class="text-sm">单任务测试</span>
                    </label>
                    <label class="flex items-center cursor-pointer">
                        <input type="radio" name="taskMode" value="chain" class="mr-2">
                        <span class="text-sm">任务链测试</span>
                    </label>
                </div>
            </div>

            <!-- Single Task Panel -->
            <div id="singleTaskPanel">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">选择任务</label>
                    <button id="selectTaskBtn" class="w-full px-4 py-3 border border-gray-200 rounded-xl text-left hover:border-purple-500 transition focus:ring-2 focus:ring-purple-500">
                        <span id="selectedTaskName" class="text-gray-500">-- 点击选择任务 --</span>
                    </button>
                    <input type="hidden" id="selectedTaskId" value="">
                </div>

                <div class="mb-4">
                    <label class="flex items-center">
                        <input type="checkbox" id="enableRepeat" class="mr-2">
                        <span class="text-sm font-medium text-gray-700">启用重复执行</span>
                    </label>
                    <div id="repeatConfig" class="mt-2 ml-6" style="display: none;">
                        <label class="block text-sm text-gray-600 mb-1">重复次数</label>
                        <input type="number" id="repeatCount" value="100" min="1" max="1000" class="w-32 px-4 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 transition">
                    </div>
                </div>
            </div>

            <!-- Chain Task Panel -->
            <div id="chainTaskPanel" style="display: none;">
                <div class="mb-4">
                    <div class="flex justify-between items-center mb-2">
                        <label class="block text-sm font-medium text-gray-700">任务链配置</label>
                        <button id="addToChainBtn" class="btn-secondary text-white px-4 py-2 rounded-xl text-sm font-medium shadow-lg">
                            + 添加任务
                        </button>
                    </div>

                    <!-- 任务链流程图 -->
                    <div id="chainList" class="space-y-4 max-h-96 overflow-y-auto">
                        <!-- Chain tasks will be rendered here -->
                    </div>
                </div>
            </div>

            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">选择要测试的模型</label>
                <div id="modelCheckboxes" class="space-y-2">
                    <!-- Model checkboxes will be rendered here -->
                </div>
            </div>

            <button id="startEvalBtn" class="btn-success w-full px-6 py-3 rounded-xl font-medium shadow-lg text-white">
                开始测试
            </button>
        </div>

        <!-- Results Display -->
        <div class="glass-effect rounded-2xl p-6 shadow-lg" id="resultsSection" style="display: none;">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-semibold text-gray-800">测试结果</h2>
                <div class="flex gap-2">
                    <button id="exportCSVBtn" class="px-4 py-2 bg-green-50 text-green-600 border border-green-200 rounded-xl hover:bg-green-100 transition font-medium">
                        📥 导出CSV
                    </button>
                    <button id="exportBtn" class="px-4 py-2 text-gray-700 border border-gray-300 rounded-xl hover:bg-gray-50 transition font-medium">
                        导出JSON
                    </button>
                </div>
            </div>

            <div id="resultsContent">
                <!-- Results will be rendered here -->
            </div>
        </div>
    </main>

    <!-- Task Selection Modal -->
    <div id="taskSelectionModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50" style="backdrop-filter: blur(5px);">
        <div class="glass-effect rounded-2xl max-w-2xl w-full mx-4 max-h-[80vh] overflow-hidden shadow-2xl">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <div class="flex items-center gap-3">
                        <h2 class="text-2xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">
                            选择任务
                        </h2>
                        <span id="taskCount" class="text-sm text-gray-500 bg-gray-100 px-3 py-1 rounded-full"></span>
                    </div>
                    <button id="closeTaskModal" class="text-gray-500 hover:text-gray-700 text-2xl">
                        ×
                    </button>
                </div>

                <!-- 搜索框 -->
                <div class="search-box mb-4">
                    <input
                        type="text"
                        id="taskSearchInput"
                        placeholder="搜索任务名称、描述、标签或提示词..."
                        class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 transition"
                    />
                </div>

                <!-- 任务列表 -->
                <div id="modalTaskList" class="space-y-2 max-h-96 overflow-y-auto">
                    <!-- Tasks will be rendered here -->
                </div>

                <!-- 空状态 -->
                <div id="modalEmptyState" class="text-center py-12" style="display: none;">
                    <div class="text-5xl mb-3">📝</div>
                    <p class="text-gray-600">暂无任务</p>
                    <a href="tasks.html" class="text-purple-600 hover:text-purple-800 text-sm mt-2 inline-block">
                        前往创建任务 →
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Modal -->
    <div id="loadingModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center" style="display: none;">
        <div class="glass-effect rounded-2xl p-8 max-w-md">
            <div class="text-center">
                <div class="spinner mx-auto mb-4"></div>
                <h3 class="text-xl font-semibold mb-2 text-gray-800">正在测试中...</h3>
                <p id="loadingText" class="text-gray-600">正在调用模型API...</p>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script type="module" src="js/app.js"></script>
</body>
</html>
